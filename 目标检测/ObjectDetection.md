# 目标检测

### yolov5

#### input
* AutoAnchor：每次新建训练任务，会根据当前的训练数据，重新计算anchor
* 自适应图片缩放：按照输入图片的比例缩放到指定尺寸，不足的地方用纯色（114）补充

#### backone
* CSP结构
* Focus结构，对输入图片进行切片，切片后的数据叠加得到新的输入数据，切片规则：在行列上每隔N个像素进行一次采样，将采样后的结果进行拼接得到一张 (W/N,H/N,3)的图片。
* CBM结构，M为Mish，是一种更加平滑的激活函数

#### neck
* FPN 
  * 特征上采样，得到的结果与浅层同尺寸大小的feature进行融合
* PAN 
  * 特征上采样之后，再进行下采样，在FPN的基础上再进行一次反向操作，深层特征下采样，与浅层同尺寸的特征进行融合。
* SPP 
  * Spatial Pyramid Pooling(空间金字塔池化),用多个不同尺寸的核，对特征进行池化，并将池化后的后果进行拼接，得到固定长度的特征表达，用于后续的分类（优势：降低目标大小对分类的影响）

#### loss
* smooth l1 loss
	* 自变量在0附近为二次函数，远离0是一次函数，好处是：训练初期，loss较大，可以提高模型拟合的稳定性，训练后期，损失值很小，梯度也会减小（在不调节学习率的情况下，相比于一次函数），可防止模型在局部震荡。
* IoU loss
  * 解决了训练过程与预测过程度量指标不一致的问题（原先采用目标boxe的偏移作为回归目标，预测过程采用目标重叠面积的交并比作为评价指标）
* GIoU loss
  * 解决了IoU loss在目标框与预测框没有重叠面积时，梯度为0的情况
* DIoU loss
  * 引入目标框中心距离的概念，反映了预测框目标框完全包围情况下，回归目标的好坏程度
* CIoU loss
  * 引入了box长宽比的概念，希望预测目标的长宽比例更倾向于标注目标。
    * 计算时需要用到标注框的宽与高，因此在推理的过程中无法使用CIoU NMS，转而使用DIoU NMS。


#### NMS
* DIoU NMS
	* IoU-x,小于阈值则保留，大于阈值则过滤；x表示box的中心距与最小外包围对角线距离的比值
	*  x越大（beta越小），越容易保留更多的目标框，通过调节beta值，可缓解遮挡物体的检测效果。
	
#### 数据增强
* mosaic
	* 随机筛选四张图进行拼接 
* MixUp
  * 两张图片以一定的比例进行图片叠加，标签按数量增加
* CutMix
    * 把一张图抠出来，粘到另外一张图上去
